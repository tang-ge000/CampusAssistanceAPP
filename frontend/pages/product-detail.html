<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å•†å“è¯¦æƒ… - æ ¡å›­äº’åŠ©å¹³å°</title>
    <link rel="stylesheet" href="../src/assets/css/style.css">
    <link rel="stylesheet" href="../src/assets/css/button-fix.css">
    <style>
        /* å•†å“è¯¦æƒ…é¡µæ ·å¼*/
        .detail-container {
            max-width: 1000px;
            margin: 20px auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .detail-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .back-btn {
            padding: 8px 15px;
            background-color: #f1f1f1;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .product-content {
            display: flex;
            gap: 30px;
            margin-bottom: 30px;
        }

        .product-images {
            flex: 0 0 50%;
        }

        .main-image {
            width: 100%;
            border-radius: 8px;
            margin-bottom: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .image-thumbnails {
            display: flex;
            gap: 10px;
            overflow-x: auto;
        }

        .thumbnail {
            width: 80px;
            height: 80px;
            border-radius: 4px;
            object-fit: cover;
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.3s;
        }

        .thumbnail:hover,
        .thumbnail.active {
            opacity: 1;
            border: 2px solid #3498db;
        }

        .product-info {
            flex: 1;
        }

        .product-title {
            font-size: 24px;
            margin-top: 0;
            margin-bottom: 10px;
        }

        .product-price {
            font-size: 28px;
            color: #e74c3c;
            font-weight: bold;
            margin: 10px 0;
        }

        .original-price {
            font-size: 18px;
            color: #777;
            text-decoration: line-through;
            margin-left: 10px;
        }

        .product-meta {
            margin: 20px 0;
        }

        .meta-item {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .meta-label {
            font-weight: bold;
            min-width: 80px;
        }

        .product-description {
            margin-top: 20px;
            line-height: 1.6;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .action-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 4px;
            font-weight: bold;
            cursor: pointer;
        }

        .buy-btn {
            background-color: #e74c3c;
            color: white;
        }

        .contact-btn {
            background-color: #3498db;
            color: white;
        }

        .favorite-btn {
            background-color: #f1f1f1;
            color: #333;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .favorite-btn.active {
            background-color: #f39c12;
            color: white;
        }

        .seller-info {
            margin-top: 30px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }

        .seller-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .seller-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #3498db;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .seller-name {
            font-weight: bold;
            font-size: 18px;
        }

        .related-products {
            margin-top: 40px;
        }

        .related-title {
            font-size: 20px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .related-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 15px;
        }

        .related-card {
            border: 1px solid #eee;
            border-radius: 8px;
            overflow: hidden;
            transition: transform 0.3s;
        }

        .related-card:hover {
            transform: translateY(-5px);
        }

        .related-image {
            width: 100%;
            height: 120px;
            object-fit: cover;
        }

        .related-info {
            padding: 10px;
        }

        .related-title {
            font-size: 14px;
            margin: 0 0 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .related-price {
            font-size: 16px;
            color: #e74c3c;
            font-weight: bold;
        }

        /* æ¶ˆæ¯è¡¨å• */
        .message-form {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .message-input {
            width: 100%;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            resize: vertical;
            min-height: 100px;
            margin-bottom: 15px;
        }

        .send-btn {
            padding: 10px 20px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .product-content {
                flex-direction: column;
            }

            .action-buttons {
                flex-wrap: wrap;
            }

            .action-btn {
                flex: 1 0 40%;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- å¯¼èˆªæ -->
        <nav class="navbar">
            <div class="nav-brand">æ ¡å›­äº’åŠ©å¹³å°</div>
            <div class="nav-links">
                <a href="index.html">é¦–é¡µ</a>
                <a href="market.html" class="active">äºŒæ‰‹å¸‚åœº</a>
                <a href="express.html">å¿«é€’ä»£é¢†</a>
                <a href="profile.html">ä¸ªäººä¸­å¿ƒ</a>
            </div>
        </nav>

        <!-- å•†å“è¯¦æƒ…å†…å®¹ -->
        <div class="detail-container">
            <div class="detail-header">
                <button class="back-btn" id="backBtn">è¿”å›åˆ—è¡¨</button>
            </div>

            <div class="product-content">
                <div class="product-images">
                    <img src="https://via.placeholder.com/500x400" alt="å•†å“ä¸»å›¾" class="main-image" id="mainImage">
                    <div class="image-thumbnails">
                        <img src="https://via.placeholder.com/500x400" alt="ç¼©ç•¥å›¾" class="thumbnail active" data-src="https://via.placeholder.com/500x400">
                        <img src="https://via.placeholder.com/500x400?text=Image+2" alt="ç¼©ç•¥å›¾" class="thumbnail" data-src="https://via.placeholder.com/500x400?text=Image+2">
                        <img src="https://via.placeholder.com/500x400?text=Image+3" alt="ç¼©ç•¥å›¾" class="thumbnail" data-src="https://via.placeholder.com/500x400?text=Image+3">
                    </div>
                </div>

                <div class="product-info">
                    <h1 class="product-title" id="productTitle">9æˆæ–°è®¡ç®—æœºç½‘ç»œæ•™æ</h1>
                    <div class="product-price">
                        Â¥ <span id="productPrice">25.00</span>
                        <span class="original-price">Â¥ 50.00</span>
                    </div>

                    <div class="product-meta">
                        <div class="meta-item">
                            <span class="meta-label">å•†å“æˆè‰²:</span>
                            <span id="productCondition">9æˆæ–°</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">å‘å¸ƒæ—¶é—´:</span>
                            <span id="publishTime">2023-06-01 10:30</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">æµè§ˆæ¬¡æ•°:</span>
                            <span id="viewCount">32</span>
                        </div>
                    </div>

                    <div class="product-description">
                        <h3>å•†å“æè¿°</h3>
                        <p id="productDescription">
                            å…¨æ–°æ­£ç‰ˆæ•™æï¼Œé€‚ç”¨äºè®¡ç®—æœºç½‘ç»œè¯¾ç¨‹ï¼Œä»…ç¿»é˜…è¿‡å‡ æ¬¡ï¼Œå‡ ä¹å…¨æ–°ã€‚å†…é¡µå¹²å‡€æ— ç¬”è®°ï¼Œæ— ç¼ºé¡µã€‚åŸä»·50å…ƒï¼Œç°åœ¨åŠä»·å‡ºå”®ã€‚æ ¡å†…å½“é¢äº¤æ˜“ï¼Œæ–¹ä¾¿å¿«æ·ã€‚æœ‰éœ€è¦çš„åŒå­¦è¯·è”ç³»æˆ‘ã€‚
                        </p>
                    </div>

                    <div class="action-buttons">
                        <button class="action-btn buy-btn" id="buyBtn">ç«‹å³è´­ä¹°</button>
                        <button class="action-btn contact-btn" id="contactBtn">è”ç³»å–å®¶</button>
                        <button class="action-btn favorite-btn" id="favoriteBtn">æ”¶è—</button>
                    </div>
                </div>
            </div>

            <div class="seller-info">
                <div class="seller-header">
                    <div class="seller-avatar">ğŸ‘¤</div>
                    <div>
                        <div class="seller-name" id="sellerName">å¼ åŒå­¦</div>
                        <div>å‘å¸ƒå•†å“<span id="sellerProductCount">5</span> ä»¶å•†å“</div>
                    </div>
                </div>
                <p>æ ¡å†…äº¤æ˜“ï¼Œå½“é¢éªŒè´§ä»˜æ¬¾ã€‚ä¸è®®ä»·ï¼Œè¯·çœ‹æ¸…å•†å“æè¿°å†è”ç³»ã€‚</p>
            </div>

            <div class="message-form">
                <h3>ç•™è¨€å’¨è¯¢</h3>
                <textarea class="message-input" placeholder="å¯¹è¿™ä¸ªå•†å“æœ‰ä»€ä¹ˆç–‘é—®ï¼Ÿåœ¨è¿™é‡Œç•™è¨€ç»™å–å®¶..."></textarea>
                <button class="send-btn" id="sendMessageBtn">å‘é€ç•™è¨€</button>
            </div>

            <div class="related-products">
                <h2 class="related-title">ç›¸å…³å•†å“æ¨è</h2>
                <div class="related-grid">
                    <div class="related-card" data-id="101">
                        <img src="https://via.placeholder.com/180x120" alt="ç›¸å…³å•†å“1" class="related-image">
                        <div class="related-info">
                            <h3 class="related-title">æ•°æ®ç»“æ„æ•™æ</h3>
                            <div class="related-price">Â¥ 30.00</div>
                        </div>
                    </div>
                    <div class="related-card" data-id="102">
                        <img src="https://via.placeholder.com/180x120" alt="ç›¸å…³å•†å“2" class="related-image">
                        <div class="related-info">
                            <h3 class="related-title">è®¡ç®—æœºç»„æˆåŸç†</h3>
                            <div class="related-price">Â¥ 28.00</div>
                        </div>
                    </div>
                    <div class="related-card" data-id="103">
                        <img src="https://via.placeholder.com/180x120" alt="ç›¸å…³å•†å“3" class="related-image">
                        <div class="related-info">
                            <h3 class="related-title">æ“ä½œç³»ç»Ÿæ¦‚å¿µ</h3>
                            <div class="related-price">Â¥ 35.00</div>
                        </div>
                    </div>
                    <div class="related-card" data-id="104">
                        <img src="https://via.placeholder.com/180x120" alt="ç›¸å…³å•†å“4" class="related-image">
                        <div class="related-info">
                            <h3 class="related-title">è½¯ä»¶å·¥ç¨‹å¯¼è®º</h3>
                            <div class="related-price">Â¥ 20.00</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ¶ˆæ¯æç¤º -->
        <div id="message" class="message" style="display: none;"></div>
    </div>

    <script>
        // è·å–URLå‚æ•°
        function getUrlParameter(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        // æ˜¾ç¤ºæ¶ˆæ¯æç¤º
        function showMessage(message, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.textContent = message;
            messageDiv.className = `message ${type}`;
            messageDiv.style.display = 'block';
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 3000);
        }

        // åˆ‡æ¢å•†å“å›¾ç‰‡
        document.querySelectorAll('.thumbnail').forEach(thumbnail => {
            thumbnail.addEventListener('click', function() {
                // æ›´æ–°é€‰ä¸­çŠ¶æ€
                document.querySelectorAll('.thumbnail').forEach(thumb => {
                    thumb.classList.remove('active');
                });
                this.classList.add('active');
                
                // æ›´æ–°ä¸»å›¾
                const mainImage = document.getElementById('mainImage');
                mainImage.src = this.getAttribute('data-src');
            });
        });

        // è¿”å›æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        document.getElementById('backBtn').addEventListener('click', function() {
            window.history.back();
        });

        // æ”¶è—æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        let isFavorite = false;
        document.getElementById('favoriteBtn').addEventListener('click', function() {
            if (!checkAuth()) return;
            
            isFavorite = !isFavorite;
            if (isFavorite) {
                this.classList.add('active');
                this.textContent = 'å·²æ”¶è—';
                showMessage('æ”¶è—æˆåŠŸ', 'success');
                
                // ä¿å­˜æ”¶è—çŠ¶æ€
                const productId = getUrlParameter('id') || '1';
                addToFavorites(productId);
            } else {
                this.classList.remove('active');
                this.textContent = 'æ”¶è—';
                showMessage('å·²å–æ¶ˆæ”¶è—', 'info');
                
                // ç§»é™¤æ”¶è—
                const productId = getUrlParameter('id') || '1';
                removeFromFavorites(productId);
            }
        });

        // æ·»åŠ åˆ°æ”¶è—
        function addToFavorites(productId) {
            let favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
            if (!favorites.includes(productId)) {
                favorites.push(productId);
                localStorage.setItem('favorites', JSON.stringify(favorites));
            }
        }

        // ä»æ”¶è—ä¸­ç§»é™¤
        function removeFromFavorites(productId) {
            let favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
            const index = favorites.indexOf(productId);
            if (index !== -1) {
                favorites.splice(index, 1);
                localStorage.setItem('favorites', JSON.stringify(favorites));
            }
        }

        // ç«‹å³è´­ä¹°æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        document.getElementById('buyBtn').addEventListener('click', function() {
            if (!checkAuth()) return;
            
            const productId = getUrlParameter('id') || '1';
            showMessage('æ­£åœ¨å‡†å¤‡è´­ä¹°...', 'info');
            
            // å®é™…é¡¹ç›®ä¸­ï¼Œåº”è¯¥è·³è½¬åˆ°ä¸‹å•é¡µé¢æˆ–å‘èµ·è´­ä¹°è¯·æ±‚
            setTimeout(() => {
                alert('æ­¤åŠŸèƒ½å°šæœªå®ç°ï¼Œå®é™…é¡¹ç›®ä¸­åº”è·³è½¬åˆ°ä¸‹å•é¡µé¢');
            }, 1000);
        });

        // è”ç³»å–å®¶æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        document.getElementById('contactBtn').addEventListener('click', function() {
            if (!checkAuth()) return;
            
            // æ»šåŠ¨åˆ°ç•™è¨€åŒºåŸŸ
            const messageForm = document.querySelector('.message-form');
            messageForm.scrollIntoView({ behavior: 'smooth' });
            
            // èšç„¦åˆ°è¾“å…¥æ¡†
            const messageInput = document.querySelector('.message-input');
            messageInput.focus();
        });

        // å‘é€ç•™è¨€æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        document.getElementById('sendMessageBtn').addEventListener('click', function() {
            if (!checkAuth()) return;
            
            const messageInput = document.querySelector('.message-input');
            const message = messageInput.value.trim();
            
            if (!message) {
                showMessage('è¯·è¾“å…¥ç•™è¨€å†…å®¹', 'warning');
                return;
            }
            
            // å‘é€ç•™è¨€
            showMessage('ç•™è¨€å‘é€æˆåŠŸï¼Œç­‰å¾…å–å®¶å›å¤', 'success');
            messageInput.value = '';
            
            // å®é™…é¡¹ç›®ä¸­ï¼Œåº”è¯¥è°ƒç”¨APIå‘é€ç•™è¨€
        });

        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        function checkAuth() {
            const token = localStorage.getItem('token');
            if (!token) {
                showMessage('è¯·å…ˆç™»å½•', 'warning');
                setTimeout(() => {
                    window.location.href = 'login.html';
                }, 1500);
                return false;
            }
            return true;
        }

        // ç›¸å…³å•†å“ç‚¹å‡»äº‹ä»¶
        document.querySelectorAll('.related-card').forEach(card => {
            card.addEventListener('click', function() {
                const productId = this.getAttribute('data-id');
                window.location.href = `product-detail.html?id=${productId}`;
            });
        });

        // åŠ è½½å•†å“è¯¦æƒ…
        function loadProductDetail() {
            const productId = getUrlParameter('id') || '1';
            console.log('åŠ è½½å•†å“ID:', productId);
            
            // æ£€æŸ¥æ˜¯å¦æ”¶è—
            const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
            if (favorites.includes(productId)) {
                isFavorite = true;
                const favoriteBtn = document.getElementById('favoriteBtn');
                favoriteBtn.classList.add('active');
                favoriteBtn.textContent = 'å·²æ”¶è—';
            }
            
            // è®°å½•æµè§ˆå†å²
            addToBrowseHistory(productId);
            
            // å®é™…é¡¹ç›®ä¸­ï¼Œåº”è¯¥è°ƒç”¨APIè·å–å•†å“è¯¦æƒ…
            // è¿™é‡Œåªæ˜¯æ¼”ç¤ºï¼Œä½¿ç”¨å‰é¢å®šä¹‰çš„ç¤ºä¾‹æ•°æ®
        }

        // æ·»åŠ åˆ°æµè§ˆå†å²
        function addToBrowseHistory(productId) {
            let history = JSON.parse(localStorage.getItem('browseHistory') || '[]');
            
            // å¦‚æœå·²å­˜åœ¨ï¼Œå…ˆç§»é™¤
            const index = history.findIndex(item => item.id === productId);
            if (index !== -1) {
                history.splice(index, 1);
            }
            
            // æ·»åŠ åˆ°å†å²è®°å½•
            history.unshift({
                id: productId,
                time: new Date().toISOString(),
                title: document.getElementById('productTitle').textContent,
                price: document.getElementById('productPrice').textContent
            });
            
            // åªä¿ç•™æœ€å¤š20æ¡å†å²è®°å½•
            if (history.length > 20) {
                history = history.slice(0, 20);
            }
            
            localStorage.setItem('browseHistory', JSON.stringify(history));
        }

        // é¡µé¢åŠ è½½æ—¶æ‰§è¡Œ
        document.addEventListener('DOMContentLoaded', function() {
            loadProductDetail();
        });
    </script>
</body>
</html> 
